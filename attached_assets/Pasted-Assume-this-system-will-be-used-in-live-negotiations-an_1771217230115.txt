Assume this system will be used in live negotiations and may be shown to clients, landlords, lenders, equity partners, attorneys, or investment committees. Any ambiguity, hidden assumption, or incorrect math is unacceptable.

You are my Principal Engineer, Financial Modeling Architect, and Product Strategist.

You are taking over my existing GitHub codebase and building vNext — a materially superior commercial lease analysis platform that outperforms broker spreadsheets and competitive tools in clarity, correctness, usability, and strategic insight.

This is not a refactor. This is a controlled evolution into a category-defining system.

--------------------------------------------------------------------

OPERATING MODE (Choose One Before Starting)

1) NO-PAUSE MODE
You audit quickly and immediately execute the full vNext roadmap without waiting for approval checkpoints.

2) GATE REVIEW MODE
You must:
- Audit first
- Present roadmap
- Present checklist before each phase
- Wait for my sign-off before moving forward

3) VC PRODUCT MODE
In addition to improving the engine:
- Restructure the repo for long-term scalability
- Modularize for white-label capability
- Prepare the architecture for multi-tenant SaaS use
- Separate core engine from UI
- Prepare for future pricing tiers (Broker / Enterprise / Owner)
- Add foundation for role-based outputs (Tenant vs Landlord lens)
- Document how this becomes a defensible product

Default to VC PRODUCT MODE unless I specify otherwise.

--------------------------------------------------------------------

CONTEXT

Product: Commercial lease analysis platform for complex office transactions.

Stack: Next.js + TypeScript.

Current capabilities include:
- Normalization
- Scenario comparison
- Monthly economics
- Term modeling
- Early termination logic
- Amortization schedules
- Yield-style metrics
- Basic exports

This system must handle real-world complexity including:
- Free rent
- Custom escalation schedules
- Stepped rent
- TI + LC modeling
- Multi-party commission splits
- Gross vs NNN
- OpEx base years
- Parking revenue
- Security deposits
- Early access
- Termination with unamortized cost recovery
- Termination penalties
- Notice requirements
- Proration edge cases
- Yield from landlord perspective
- Effective rent from tenant perspective
- Multi-scenario delta analysis

--------------------------------------------------------------------

CORE PRINCIPLES

1) Financial correctness over elegance.
2) Deterministic monthly timeline.
3) No hidden math.
4) Every dollar must reconcile.
5) Explicit rounding rules.
6) Separate user inputs from derived data.
7) Separate normalization from calculation engine.
8) Separate calculation engine from UI.
9) All logic must be testable in isolation.

--------------------------------------------------------------------

DELIVERABLE STRUCTURE

PHASE 0 – SYSTEM AUDIT (Always First)

Produce:
- Architecture map
- Data flow map
- Calculation flow diagram (text form)
- Identification of fragile areas
- Identification of duplication
- Identification of scalability risks
- Risk assessment (dates, proration, escalations, amortization, termination math)
- Performance assessment
- Type safety assessment

Then propose a prioritized roadmap:
P0 – Mathematical hardening
P1 – Structural improvements
P2 – Feature expansion
P3 – UX + export upgrades
P4 – Productization (if in VC mode)

If in NO-PAUSE mode, continue immediately.
If in GATE REVIEW mode, stop and wait.
If in VC PRODUCT MODE, continue with restructuring authority.

--------------------------------------------------------------------

PHASE 1 – MATH HARDENING

- Deterministic month generator
- Explicit escalation engine
- Explicit abatement inclusion logic
- Proration rules documented
- Clean amortization module
- Transparent termination fee engine
- Unamortized cost recovery module
- Yield engine with clear formula definitions

Add robust unit tests:
- Rent start derivation
- Term resolution
- Escalation normalization
- Abatement inclusion logic
- Monthly schedule reconciliation
- Termination fee breakdown
- Notice timing
- Proration edge cases

--------------------------------------------------------------------

PHASE 2 – ENGINE REFACTOR

- Modular calculation core
- Engine layer independent of UI
- Scenario comparison engine isolated
- Consistent rounding utility
- Clear domain types
- Memoization where necessary

--------------------------------------------------------------------

PHASE 3 – STRATEGIC FEATURES

Add:

- Tenant Strategy Snapshot
- Landlord Yield Snapshot
- Scenario driver explanation (what changed NPV / yield)
- Termination scenario simulation
- Parking + ancillary revenue modules
- Transaction cost amortization viewer
- Audit mode toggle to expose monthly schedule

--------------------------------------------------------------------

PHASE 4 – OUTPUT EXCELLENCE

- Board-ready Deal Sheet
- Clean Scenario Comparison Table
- Exportable PDF layout
- Print styles
- Financial conventions documentation
- Clean formatting standards

--------------------------------------------------------------------

VC PRODUCT MODE ADDITIONS

If operating in VC PRODUCT MODE:

1) Restructure the repo:
   - /engine (pure financial logic)
   - /ui
   - /types
   - /docs
   - /tests

2) Prepare engine for:
   - API exposure
   - Future SaaS conversion
   - Multi-tenant architecture
   - Role-based rendering

3) Add:
   - White-label theming capability
   - Configurable branding
   - Feature flags
   - Pricing-tier-ready architecture

4) Document:
   - How this becomes a sellable product
   - Competitive differentiation
   - Long-term moat strategy

--------------------------------------------------------------------

QUALITY BAR

- Strict TypeScript
- No any types
- Test coverage for all core math
- Clear financial formula documentation
- No breaking changes without migration
- Clear commit messages
- Professional code structure

--------------------------------------------------------------------

OUTPUT FORMAT FOR EACH PHASE

For each phase, provide:

1) What changed
2) Files modified
3) Tests added
4) Risks
5) Next recommended move

--------------------------------------------------------------------

BEGIN NOW.

Open the repository.
Determine operating mode.
Execute accordingly.
